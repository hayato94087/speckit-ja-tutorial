---
description: インタラクティブまたは提供された原則入力からプロジェクトコンスティテューション（憲章）を作成または更新し、すべての依存テンプレートが同期していることを確認します。
handoffs: 
  - label: speckit.specify
    agent: speckit.specify
    prompt: 更新されたコンスティテューション（憲章）に基づいて機能仕様を実装します。私が作りたいのは...
---

## ユーザー入力

```text
$ARGUMENTS
```

続行する前に、ユーザー入力を考慮する**必要があります**（空でない場合）。

## 概要

あなたはプロジェクトコンスティテューション（憲章）を作成または更新しています。テンプレートは `.specify/templates/constitution-template.md` にあり、生成結果は `.specify/memory/constitution.md` に出力されます。テンプレートは角括弧内のプレースホルダートークンを含みます（例: `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。あなたの仕事は (a) 具体的な値を収集/導出し、(b) テンプレートを正確に埋め、(c) 依存アーティファクト全体に修正を伝播することです。

この実行フローに従ってください:

1. `.specify/templates/constitution-template.md` のテンプレートを読み込む。
   - `[ALL_CAPS_IDENTIFIER]` 形式のすべてのプレースホルダートークンを特定。
   **重要**: ユーザーはテンプレートで使用されているものより少ないまたは多い原則を必要とする場合があります。数が指定された場合、それを尊重 - 一般的なテンプレートに従ってください。それに応じてドキュメントを更新します。

1.1. **スタイルガイドを読み込み**: `.specify/README.md` を読み込んで用語集とスタイルガイドを把握。
   - セクション見出しには規定の絵文字を使用する
   - 用語対応表に従って一貫した日本語表現を使用する
   - 英語維持する特殊文字列（マーカー、ステータス、ファイル名等）は変換しない

1.2. `.specify/memory/constitution.md` が既に存在する場合、既存のバージョン情報を読み取る。
   - `CONSTITUTION_VERSION`、`RATIFICATION_DATE`、`LAST_AMENDED_DATE` を抽出し、バージョン継承の基準とする。
   - 存在しない場合は初回生成として扱い、バージョンは `1.0.0` から開始。

2. プレースホルダーの値を収集/導出:
   - ユーザー入力（会話）が値を提供する場合、それを使用。
   - それ以外の場合は既存のリポジトリコンテキスト（README、ドキュメント、既存の `.specify/memory/constitution.md`）から推測。
   - ガバナンス日付について: `RATIFICATION_DATE` は元の採用日（初回生成時は今日、不明な場合は質問するかTODOをマーク）、`LAST_AMENDED_DATE` は変更が行われた場合は今日、そうでなければ以前のものを維持。
   - `CONSTITUTION_VERSION` はセマンティックバージョニングルールに従ってインクリメントする必要がある:
     - MAJOR: 後方互換性のないガバナンス/原則の削除または再定義。
     - MINOR: 新しい原則/セクションの追加または実質的に拡張されたガイダンス。
     - PATCH: 明確化、言い回し、タイポ修正、非セマンティックな改良。
   - バージョンバンプタイプが曖昧な場合、最終決定前に理由を提案。

3. 更新されたコンスティテューション（憲章）コンテンツのドラフトを作成:
   - すべてのプレースホルダーを具体的なテキストに置き換える（プロジェクトがまだ定義しないことを選択した意図的に保持されたテンプレートスロットを除き、角括弧のトークンは残さない—残った場合は明示的に正当化）。
   - `[TOC]` プレースホルダーを実際の目次に置き換える。目次はセクション構成に基づいて動的に生成:
     - コアプリンシプルと各原則のサブセクションをリスト
     - 追加セクション（SECTION_2, SECTION_3等）をリスト
     - ガバナンスセクションをリスト
     - Markdownアンカーリンク形式を使用（例: `- [コアプリンシプル](#-コアプリンシプル)`）
     - 目次の表示テキストには絵文字を含めない（見出しには絵文字があるが、目次リンクのテキストからは除く）
     - 絵文字付き見出しのアンカーは絵文字を除いた形式で生成（例: `## 🎯 コアプリンシプル` → `#-コアプリンシプル`）
   - `[EMOJI_N]` プレースホルダー（可変セクション用）を、セクション内容に適した絵文字に置き換える:
     - 技術スタック → 🛠️
     - セキュリティ → 🔐
     - パフォーマンス → ⚡
     - 開発ワークフロー → 📝
     - レビュープロセス → 👀
     - 品質ゲート → ✅
     - 命名規則 → 📛
     - その他 → セクション内容に最も適した絵文字を選択
   - 見出し階層を保持し、コメントは明確なガイダンスを追加しない限り置き換えたら削除可能。
   - 各原則セクションを確保: 簡潔な名前行、交渉不可のルールをキャプチャする段落（または箇条書きリスト）、明らかでない場合は明示的な根拠。
   - ガバナンスセクションが修正手続き、バージョニングポリシー、コンプライアンスレビュー期待をリストしていることを確認。

4. 一貫性伝播チェックリスト（以前のチェックリストをアクティブな検証に変換）:
   - `.specify/templates/plan-template.md` を読み込み、"Constitution Check"またはルールが更新された原則と整合していることを確認。
   - `.specify/templates/spec-template.md` をスコープ/要件の整合のために読み込む—コンスティテューション（憲章）が必須セクションまたは制約を追加/削除した場合は更新。
   - `.specify/templates/tasks-template.md` を読み込み、タスク分類が新しいまたは削除された原則駆動のタスクタイプ（例: オブザーバビリティ、バージョニング、テスト規律）を反映していることを確認。
   - `.specify/templates/commands/*.md` の各コマンドファイル（これを含む）を読み込み、一般的なガイダンスが必要な場合に古い参照（CLAUDEのようなエージェント固有の名前のみ）が残っていないことを確認。
   - ランタイムガイダンスドキュメント（例: `README.md`、`docs/quickstart.md`、または存在する場合はエージェント固有のガイダンスファイル）を読み込む。変更された原則への参照を更新。

5. 同期影響レポートを作成（更新後にコンスティテューション（憲章）ファイルの上部にHTMLコメントとして前置き）:
   - バージョン変更: 旧 → 新
   - 変更された原則のリスト（名前が変更された場合は旧タイトル → 新タイトル）
   - 追加されたセクション
   - 削除されたセクション
   - 更新が必要なテンプレート（✅ 更新済み / ⚠ 保留中）とファイルパス
   - プレースホルダーが意図的に延期された場合のフォローアップTODO。

6. 最終出力前の検証:
   - 説明のない角括弧トークンが残っていない。
   - バージョン行がレポートと一致。
   - 日付はISO形式YYYY-MM-DD。
   - 原則は宣言的、テスト可能で、曖昧な言語がない（"should" → 適切な場合はMUST/SHOULDの根拠に置き換え）。
   - 目次が実際のセクション構成と一致していることを確認（リンク先が正しい見出しを指している）。

7. 完成したコンスティテューション（憲章）を `.specify/memory/constitution.md` に書き出す（新規作成または上書き）。
   - テンプレート（`.specify/templates/constitution-template.md`）は変更しない。

8. 以下を含む最終サマリーをユーザーに出力:
   - 新しいバージョンとバンプの根拠。
   - 手動フォローアップのためにフラグが立てられたファイル。
   - 推奨コミットメッセージ（例: `docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

フォーマットとスタイル要件:

- テンプレートと完全に同じMarkdown見出しを使用（レベルを降格/昇格しない）。
- 長い根拠行は可読性を保つために折り返す（理想的には100文字未満）が、不自然な改行で強制しない。
- セクション間に1つの空白行を保持。
- 末尾の空白を避ける。

ユーザーが部分的な更新を提供した場合（例: 1つの原則の修正のみ）でも、検証とバージョン決定ステップを実行。

重要な情報が欠落している場合（例: 批准日が本当に不明）、`TODO(<FIELD_NAME>): 説明` を挿入し、同期影響レポートの延期項目に含める。

テンプレート（`.specify/templates/constitution-template.md`）は変更しない; 常に `.specify/memory/constitution.md` を操作（新規作成または上書き）。