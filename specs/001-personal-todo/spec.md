# 機能仕様

| 項目 | 内容 |
| --- | --- |
| **機能名** | 個人用 ToDo アプリ |
| **機能ブランチ** | `001-personal-todo` |
| **作成日** | 2026-02-03 |
| **ステータス** | 下書き |

## 📑 目次

- [1. 入力](#-1-入力)
- [2. 明確化事項](#-2-明確化事項)
- [3. ユーザーストーリー（必須）](#-3-ユーザーストーリー必須)
  - [3.1 US1: タスクの素早い追加](#31-us1-タスクの素早い追加-p1)
  - [3.2 US2: タスクの完了管理](#32-us2-タスクの完了管理-p1)
  - [3.3 US3: タスクの編集と削除](#33-us3-タスクの編集と削除-p1)
  - [3.4 US4: タスク一覧のフィルタリング](#34-us4-タスク一覧のフィルタリング-p2)
  - [3.5 US5: データの永続化と復旧](#35-us5-データの永続化と復旧-p1)
  - [3.6 エッジケース](#36-エッジケース)
- [4. 要件（必須）](#-4-要件必須)
  - [4.1 機能要件](#41-機能要件)
  - [4.2 非機能要件](#42-非機能要件)
  - [4.3 主要エンティティ](#43-主要エンティティ)
- [5. 成功基準（必須）](#-5-成功基準必須)
  - [5.1 測定可能な成果](#51-測定可能な成果)
- [6. 用語集](#-6-用語集)
- [7. 前提条件](#-7-前提条件)

## 📥 1. 入力

`/speckit.specify` コマンドの引数として提供された入力情報を以下に記載します。

```
個人用の ToDo アプリを作りたいです。
技術スタックは後で決めるので、まず「何を作るか」を仕様書（spec）としてまとめてください。

目的（Why）:
- やることを素早く追加し、今日やることに集中したい
- タスクが増えても迷わず整理できるようにしたい

スコープ（What）:
- ToDo の追加/完了切替/編集/削除
- 一覧のフィルタ（例：すべて/未完了/完了済み）
- データは端末内に保存し、リロードしても復元される

制約（Constraints）:
- オフライン前提で主要導線が使える
- 保存データが壊れていてもクラッシュせず、安全に復旧できる（可能なら旧形式にも対応）
- a11y（キーボード操作、フォーカス可視化、適切なラベル）を受け入れ条件に含める

スコープ外（Out of Scope）:
- ログイン/同期/共有
- 通知、リマインダー
```

## � 2. 明確化事項

### Session 2026-02-03

- Q: タスク名の最大文字数制限は？ → A: 255文字
- Q: パフォーマンス目標として対応するタスク件数は？ → A: 1,000件
- Q: 旧形式データのマイグレーション対応方針は？ → A: ベストエフォートで変換を試み、失敗時は空の状態で開始（データ損失を警告）
- Q: 複数タブでの同時編集時のユーザー通知方法は？ → A: リロード時に「データが更新されました」と通知
- Q: タスクのID生成方式は？ → A: UUID v4（`crypto.randomUUID()`）

## 👤 3. ユーザーストーリー（必須）

**ストーリーID凡例**:

| ID | 意味 | 説明 |
|----|------|------|
| `US1`, `US2`... | ユーザーストーリーID | tasks.mdの`[US1]`と対応。spec.mdの§2.xセクションに対応 |

**優先度凡例**:

| 優先度 | 意味 | 説明 |
|--------|------|------|
| P1 | 必須 | MVPに必須。これがないとリリースできない |
| P2 | 重要 | MVPに含めたい。時間が許せば実装 |
| P3 | あれば良い | 将来の拡張として検討。今回は実装しない可能性あり |

**憲章要件（必須）**:

- 各ユーザーストーリーに対して、どの粒度（Unit / Integration / E2E）で何を担保するかを明記する
- UIがある場合、モバイル幅での期待挙動（レスポンシブ）を受入シナリオに含める
- 新規ファイル名はkebab-case（例: `my-component.tsx`）を使用する

### 3.1 US1: タスクの素早い追加 [P1]

**優先度**: P1

#### 説明

- ユーザーが思いついたタスクを素早く入力し、ToDo リストに追加する
- 入力欄にタスク名を入力し、確定操作でリストに追加される
- 追加されたタスクは即座に一覧に表示される

#### この優先度の理由

- ToDo アプリの最も基本的な機能であり、これがなければアプリとして成立しない
- ユーザーの「やることを素早く追加したい」という主要目的を直接実現する

#### 独立テスト

- タスク追加機能のみでテスト可能
- 「タスクを入力して追加」という単純なフローで価値を提供できる

#### テスト粒度

- **Unit**: 入力バリデーション（空文字、長さ制限）
- **Integration**: タスク追加後のストレージ保存
- **E2E**: 入力→追加→一覧表示の一連の流れ

#### 受入シナリオ

1. タスクを追加する
   - **Given**: ToDo アプリを開いている
   - **When**: 入力欄にタスク名を入力し、確定操作を行う
   - **Then**: 入力したタスクが未完了タスクとして一覧に追加される

2. 空のタスクは追加できない
   - **Given**: ToDo アプリを開いている
   - **When**: 入力欄が空の状態で確定操作を行う
   - **Then**: タスクは追加されず、入力欄にフォーカスが残る

3. キーボードでタスクを追加する
   - **Given**: 入力欄にフォーカスがある
   - **When**: タスク名を入力し、Enter キーを押す
   - **Then**: タスクが追加され、入力欄がクリアされる

4. モバイル幅での表示
   - **Given**: 画面幅が狭い端末で ToDo アプリを開いている
   - **When**: タスク追加操作を行う
   - **Then**: 入力欄と追加ボタンがタップしやすいサイズで表示され、操作できる

5. アクセシビリティ対応
   - **Given**: スクリーンリーダーを使用している
   - **When**: タスク入力欄を操作する
   - **Then**: 入力欄のラベルが読み上げられ、追加成功時に通知される

### 3.2 US2: タスクの完了管理 [P1]

**優先度**: P1

#### 説明

- ユーザーがタスクを完了したときに、完了状態に切り替える
- 完了したタスクは視覚的に区別される（取り消し線など）
- 間違えて完了にした場合は、未完了に戻せる

#### この優先度の理由

- 完了管理は ToDo アプリの本質的な価値
- 「今日やること」に集中するために、終わったものを区別する必要がある

#### 独立テスト

- 既存のタスクがある状態で完了/未完了の切り替えをテスト
- 完了状態の視覚的フィードバックを確認

#### テスト粒度

- **Unit**: 完了フラグの切り替えロジック
- **Integration**: 完了状態のストレージ永続化
- **E2E**: 完了→表示更新→リロード後も状態維持

#### 受入シナリオ

1. タスクを完了にする
   - **Given**: 未完了のタスクが一覧にある
   - **When**: タスクの完了操作を行う
   - **Then**: タスクが完了状態になり、取り消し線と薄い文字色で視覚的に区別される

2. タスクを未完了に戻す
   - **Given**: 完了済みのタスクが一覧にある
   - **When**: タスクの完了状態を解除する
   - **Then**: タスクが未完了状態に戻り、通常の表示になる

3. キーボードで完了を切り替える
   - **Given**: タスクにフォーカスがある
   - **When**: Space キーまたは Enter キーを押す
   - **Then**: 完了状態が切り替わる

4. モバイル幅での操作
   - **Given**: 画面幅が狭い端末でタスク一覧を表示している
   - **When**: タスクをタップする
   - **Then**: 完了状態が切り替わる（タップ領域が十分確保されている）

5. アクセシビリティ対応
   - **Given**: スクリーンリーダーを使用している
   - **When**: タスクの完了操作を行う
   - **Then**: 現在の状態と状態変更が読み上げられる

### 3.3 US3: タスクの編集と削除 [P1]

**優先度**: P1

#### 説明

- ユーザーが既存のタスク名を修正できる
- 不要になったタスクを削除できる
- 削除は誤操作を防ぐため、確認なしで即座に実行されるが、視覚的なフィードバックがある

#### この優先度の理由

- タスクの整理には編集と削除が不可欠
- 入力ミスの修正や状況変化への対応に必要

#### 独立テスト

- 既存のタスクがある状態で編集/削除操作をテスト
- 編集後と削除後の一覧表示を確認

#### テスト粒度

- **Unit**: タスク名の更新ロジック、削除ロジック
- **Integration**: 編集/削除後のストレージ反映
- **E2E**: 編集→保存→リロード後も反映、削除→一覧から消える

#### 受入シナリオ

1. タスクを編集する
   - **Given**: タスクが一覧にある
   - **When**: タスクの編集操作を行い、新しいタスク名を入力して確定する
   - **Then**: タスク名が更新される

2. 編集をキャンセルする
   - **Given**: タスクの編集モードに入っている
   - **When**: Escape キーを押すか、編集をキャンセルする
   - **Then**: 変更が破棄され、元のタスク名が維持される

3. タスクを削除する
   - **Given**: タスクが一覧にある
   - **When**: タスクの削除操作を行う
   - **Then**: タスクが一覧から削除され、「削除しました」のToast通知とUndo機能が表示される

4. キーボードで編集・削除する
   - **Given**: タスクにフォーカスがある
   - **When**: 編集用のキー操作を行う
   - **Then**: 編集モードに入る（または削除が実行される）

5. モバイル幅での操作
   - **Given**: 画面幅が狭い端末でタスク一覧を表示している
   - **When**: 編集・削除操作を行う
   - **Then**: 操作ボタンがタップしやすいサイズで表示され、操作できる

6. アクセシビリティ対応
   - **Given**: スクリーンリーダーを使用している
   - **When**: 編集・削除操作を行う
   - **Then**: 操作の種類と結果が読み上げられる

### 3.4 US4: タスク一覧のフィルタリング [P2]

**優先度**: P2

#### 説明

- ユーザーがタスク一覧を「すべて」「未完了」「完了済み」でフィルタリングできる
- フィルタを切り替えると、即座に一覧が更新される
- 選択中のフィルタが視覚的に分かる

#### この優先度の理由

- 「今日やること」に集中するために、未完了タスクだけを見たい場合がある
- タスクが増えても迷わず整理できるようにする目的を実現
- 基本的な CRUD 機能（US1-3）がなくても成立しないため P2

#### 独立テスト

- 複数のタスク（完了/未完了混在）がある状態でフィルタ切り替えをテスト
- 各フィルタで正しいタスクのみ表示されることを確認

#### テスト粒度

- **Unit**: フィルタリングロジック
- **Integration**: フィルタ状態の維持（リロード後）
- **E2E**: フィルタ切り替え→表示更新の一連の流れ

#### 受入シナリオ

1. 未完了タスクのみ表示する
   - **Given**: 完了と未完了のタスクが混在している
   - **When**: 「未完了」フィルタを選択する
   - **Then**: 未完了のタスクのみが表示される

2. 完了済みタスクのみ表示する
   - **Given**: 完了と未完了のタスクが混在している
   - **When**: 「完了済み」フィルタを選択する
   - **Then**: 完了済みのタスクのみが表示される

3. すべてのタスクを表示する
   - **Given**: フィルタが「未完了」または「完了済み」になっている
   - **When**: 「すべて」フィルタを選択する
   - **Then**: すべてのタスクが表示される

4. キーボードでフィルタを切り替える
   - **Given**: フィルタ選択部分にフォーカスがある
   - **When**: 矢印キーまたは Tab キーでフィルタを切り替える
   - **Then**: フィルタが切り替わり、一覧が更新される

5. モバイル幅での表示
   - **Given**: 画面幅が狭い端末で ToDo アプリを開いている
   - **When**: フィルタを操作する
   - **Then**: フィルタ選択部分がタップしやすいサイズで表示され、操作できる

6. アクセシビリティ対応
   - **Given**: スクリーンリーダーを使用している
   - **When**: フィルタを切り替える
   - **Then**: 選択中のフィルタと表示件数が読み上げられる

### 3.5 US5: データの永続化と復旧 [P1]

**優先度**: P1

#### 説明

- タスクデータは端末内に自動保存され、ブラウザをリロードしても復元される
- ネットワーク接続がなくても、すべての主要機能（追加/完了/編集/削除/フィルタ）が動作する
- 保存データが破損している場合でも、アプリがクラッシュせず安全に復旧する

#### この優先度の理由

- オフライン対応とデータ復元は明示的な制約として要求されている
- データが消えると ToDo アプリとしての価値がなくなる

#### 独立テスト

- タスクを追加後、リロードしてデータが復元されることを確認
- オフライン状態で各機能が動作することを確認
- 破損データを意図的に設定し、復旧動作を確認

#### テスト粒度

- **Unit**: データのシリアライズ/デシリアライズ、破損検出ロジック
- **Integration**: ストレージへの読み書き、復旧処理
- **E2E**: リロード後のデータ復元、オフライン動作

#### 受入シナリオ

1. リロード後にデータが復元される
   - **Given**: タスクを追加/編集した状態
   - **When**: ブラウザをリロードする
   - **Then**: すべてのタスクとその状態が復元される

2. オフラインで機能が動作する
   - **Given**: ネットワーク接続がない状態
   - **When**: タスクの追加/完了/編集/削除を行う
   - **Then**: すべての操作が正常に動作し、ローカルに保存される

3. 破損データから復旧する
   - **Given**: 保存データが破損している（不正な JSON など）
   - **When**: アプリを開く
   - **Then**: アプリがクラッシュせず、エラーメッセージを表示し、空の状態または最後の正常なデータから開始できる

4. 旧形式のデータを読み込む（ベストエフォート）
   - **Given**: 以前のバージョンの形式で保存されたデータがある
   - **When**: アプリを開く
   - **Then**: 変換を試み、成功すれば新形式で読み込む。失敗した場合は「データを復元できませんでした」と警告を表示し、空の状態で開始する

5. 他のタブでの変更を検知する
   - **Given**: 複数のタブで同じToDoアプリを開いている
   - **When**: 一方のタブでデータを変更し、他方のタブをリロードする
   - **Then**: 「データが更新されました」と通知され、最新のデータが表示される

6. アクセシビリティ対応
   - **Given**: スクリーンリーダーを使用している
   - **When**: データ復旧やエラーが発生する
   - **Then**: エラーメッセージが読み上げられる

### 3.6 エッジケース

- **空のタスク名**: 空文字や空白のみのタスクは追加できない
- **非常に長いタスク名**: タスク名は最大255文字まで。超過分は入力時に制限し、表示時は切り詰めて全文はツールチップや編集時に確認できる
- **タスクが0件**: フィルタ結果が0件の場合、適切なメッセージを表示する
- **大量のタスク**: 1,000件のタスクがあっても、スクロールやパフォーマンスが劣化しない（0.3秒以内の応答を維持）
- **ストレージ容量不足**: ローカルストレージの容量上限に達した場合、エラーを表示し、データ損失を防ぐ
- **同時編集の競合**: 複数のタブで同じToDoを開いている場合、最後の保存が優先される。他タブでの変更はリロード時に「データが更新されました」と通知

## 📝 4. 要件（必須）

### 4.1 機能要件

- **FR-001**: システムはユーザーがタスク名を入力して新しいタスクを追加できること
- **FR-002**: システムは空文字または空白のみのタスク名を拒否すること
- **FR-002a**: システムはタスク名を最大255文字に制限すること
- **FR-003**: システムはタスクの完了/未完了状態を切り替えられること
- **FR-004**: システムは完了タスクを視覚的に区別して表示すること
- **FR-005**: システムはユーザーが既存のタスク名を編集できること
- **FR-006**: システムはユーザーがタスクを削除できること
- **FR-007**: システムはタスク一覧を「すべて」「未完了」「完了済み」でフィルタリングできること
- **FR-008**: システムはタスクデータを端末内に自動保存すること
- **FR-009**: システムはページリロード後にタスクデータを復元すること
- **FR-010**: システムは保存データが破損している場合、クラッシュせずに復旧処理を行うこと

### 4.2 非機能要件

- **NFR-001**: すべての主要機能はオフライン状態で動作すること
- **NFR-001a**: 1,000件のタスクがある状態でも、すべての操作が0.3秒以内に完了すること
- **NFR-002**: すべてのインタラクティブ要素はキーボードで操作できること
- **NFR-003**: フォーカス状態が視覚的に明確に表示されること
- **NFR-004**: すべての入力要素に適切なラベルが付与されていること（スクリーンリーダー対応）
- **NFR-005**: 状態変更時に適切なフィードバックがスクリーンリーダーに通知されること
- **NFR-006**: モバイル幅（320px〜）でもすべての機能が利用できること
- **NFR-007**: タップターゲットは最小44x44ピクセルを確保すること

### 4.3 主要エンティティ

- **タスク（Task）**: ToDo リストの1項目を表す
  - `id`: UUID v4形式（`crypto.randomUUID()`で生成）
  - `title`: タスク名（最大255文字）
  - `completed`: 完了状態（boolean）
  - `createdAt`: 作成日時（ISO 8601形式）
  - `updatedAt`: 更新日時（ISO 8601形式、任意）
- **タスク一覧（Task List）**: すべてのタスクの集合。フィルタリング状態を管理する
- **フィルタ（Filter）**: タスク一覧の表示条件。「すべて」「未完了」「完了済み」のいずれか

## 🎯 5. 成功基準（必須）

### 5.1 測定可能な成果

- **SC-001**: タスク追加の効率性
  - 測定方法: タスク入力開始から追加完了までの時間
  - 目標値: 5秒以内

- **SC-002**: 操作の即時性
  - 測定方法: 操作（追加/完了/編集/削除/フィルタ）から画面反映までの時間
  - 目標値: 0.3秒以内

- **SC-003**: データ復元の信頼性
  - 測定方法: リロード後のデータ復元成功率
  - 目標値: 正常データの場合100%復元

- **SC-004**: オフライン動作
  - 測定方法: オフライン状態での機能動作率
  - 目標値: 主要機能（追加/完了/編集/削除/フィルタ）がすべて動作

- **SC-005**: アクセシビリティ
  - 測定方法: キーボードのみですべての主要操作が完了できるか
  - 目標値: 100%の主要操作がキーボードで実行可能

- **SC-006**: エラー耐性
  - 測定方法: 破損データを読み込んだ際のクラッシュ率
  - 目標値: 0%（クラッシュしない）

## 📖 6. 用語集

| 用語 | 定義 |
|------|------|
| タスク | ユーザーが追加する ToDo 項目 |
| 完了状態 | タスクが完了したかどうかを示すフラグ |
| フィルタ | 表示するタスクを絞り込む条件（すべて/未完了/完了済み） |
| 永続化 | データを端末内に保存し、再訪問時に復元できる状態にすること |
| a11y | アクセシビリティ（Accessibility）の略称 |

## 📋 7. 前提条件

- ユーザーは1人（個人用）で、認証・同期・共有機能は不要
- 対象端末はモダンブラウザ（デスクトップおよびモバイル）
- データはローカルストレージなど端末内のストレージに保存（サーバー連携なし）
- 通知やリマインダー機能はスコープ外
- タスクの並び替え機能は初期スコープ外（将来の拡張として検討可能）
